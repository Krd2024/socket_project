{% extends 'main.html' %}
{% block content %}
  <body class="body_rooms">
    <div id="list_rooms"></div>

    <textarea id="chat-log" cols="50" rows="20"></textarea><br />

    <input id="chat-message-input" type="text" size="30" /><br />

    <input id="chat-message-submit" type="button" value="Send" />

    {{ room_name|json_script:'room-name' }}
    {{ request.user.username|json_script:'user-name' }}
    {% comment %} {{ rooms|json_script:'rooms-list' }} {% endcomment %}

    {{ request.user }}
    <style>
      #chat-log {
        font-size: 20px;
        color: brown;
      }
    </style>

    <script>
      const roomName = JSON.parse(document.getElementById('room-name').textContent)
      const username = JSON.parse(document.getElementById('user-name').textContent)
      
      const url = `ws://${window.location.host}/ws/socket-server/${roomName}/?username=${username}`
      
      const chatSocket = new WebSocket(url)
      
      chatSocket.onmessage = function (e) {
        const data = JSON.parse(e.data)
        const textarea = document.querySelector('#chat-log')
        textarea.value = data.message + '\n\r' + data.dict.room
        document.querySelector('#list_rooms').innerHTML = data
        console.log(data)
        textarea.style.backgroundColor = '#f0f0f0' // Цвет фона
        textarea.style.color = '#333' // Цвет текста
        textarea.style.border = '2px solid #ccc' // Граница
        textarea.style.padding = '10px' // Внутренний отступ
        textarea.style.fontFamily = 'Arial, sans-serif' // Шрифт
        textarea.style.fontSize = '20px' // Размер шрифта
        textarea.style.resize = 'none' // Отключение изменения размера
      }
      
      chatSocket.onclose = function (e) {
        console.error('Chat socket closed unexpectedly')
      }
      
      document.querySelector('#chat-message-input').focus()
      document.querySelector('#chat-message-input').onkeyup = function (e) {
        if (e.key === 'Enter') {
          // enter, return
          document.querySelector('#chat-message-submit').click()
        }
      }
      
      document.querySelector('#chat-message-submit').onclick = function (e) {
        const messageInputDom = document.querySelector('#chat-message-input')
        const message = messageInputDom.value
        chatSocket.send(
          JSON.stringify({
            message: message
          })
        )
        messageInputDom.value = ''
      }
    </script>
  </body>
{% endblock %}
